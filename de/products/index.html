<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CoreWear &ndash; Produkte</title>
  <meta name="description" content="Produktübersicht von CoreWear: Oberteile, Unterteile, Business- &amp; Arbeitskleidung, Kleider, Sport- &amp; Freizeitkleidung, Kinderbekleidung und Haushalt. B2B-Produktion ab 100 Stück." />

  <!-- SEO (optional, aber gut) -->
  <link rel="canonical" href="https://corewear.pro/de/products/" />
  <link rel="alternate" hreflang="de" href="https://corewear.pro/de/products/" />
  <link rel="alternate" hreflang="en" href="https://corewear.pro/en/products/" />
  <link rel="alternate" hreflang="x-default" href="https://corewear.pro/en/products/" />

  <!-- Performance Hints -->
  <link rel="preconnect" href="https://corewear.pro" />

  <link rel="stylesheet" href="/assets/css/index.css" />
  <link rel="icon" type="image/png" href="/assets/img/favicon.png" />
  <meta name="referrer" content="strict-origin-when-cross-origin">

  <!-- Kleine Zusatz-Styles (Beispielgalerie + Lightbox-Fixes) -->
  
</head>
<body>
<header>
  <div class="header-bar">
    <!-- Logo -->
    <a href="/de/" class="brand">
      <img id="logo" src="/assets/img/Logo.png" alt="CoreWear Logo" />
    </a>

    <!-- Hamburger (nur sichtbar auf Mobile) -->
    <button class="hamburger" aria-label="Menü öffnen" aria-controls="mobile-nav" aria-expanded="false">
      <svg width="26" height="26" viewBox="0 0 24 24" fill="none" aria-hidden="true">
        <path d="M4 6h16M4 12h16M4 18h16" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
      </svg>
    </button>

    <!-- Mehrseiten-Navigation -->
    <nav id="mobile-nav" class="main-nav">
      <a href="/de/">Start</a>
      <a href="/de/products/" class="active" aria-current="page">Produkte</a>
      <a href="/de/process/">Ablauf</a>
      <a href="/de/about/">Über uns</a>
      <a href="/de/faq/">FAQ</a>
      <a href="/de/contact/" class="btn">Kontakt</a>

      <!-- ▶️ Sprachschalter (DE | EN) &ndash; Bildvariante -->
      <div class="lang-switch" role="group" aria-label="Sprachauswahl">
        <a class="lang-link" href="/de/" data-lang="de" role="button" aria-pressed="false" title="Deutsch">
          <img src="/assets/img/de.jpg" alt="Deutsch">
        </a>
        <a class="lang-link" href="/en/" data-lang="en" role="button" aria-pressed="false" title="English">
          <img src="/assets/img/en.jpg" alt="English">
        </a>
      </div>
    </nav>
  </div>
</header>

<!-- Overlay hinter der Off-Canvas-Navigation -->
<div class="nav-overlay" hidden></div>

<main>
  <div class="section-title">
    <h2>Produkte</h2>
  </div>
  <div class="hint-box">
    Klicke auf ein Produkt, um Stoffe, Produktion und Besonderheiten zu sehen.
  </div>

  <section class="product-layout">
    <div class="product-rows"><!-- Kategorien werden per JS eingefügt --></div>
  </section>

  <div class="section-title">
    <h2>Noch mehr Möglichkeiten</h2>
    <span class="muted">Wir sind flexibel &ndash; auch über die aufgeführten Produkte hinaus.</span>
  </div>

  <section class="grid cols-1">
    <article class="card">
      <p class="muted">
        Dein gewünschtes Produkt ist nicht in unserer Liste? Kein Problem &ndash; dank unseres Maschinenparks und Partnernetzwerks prüfen wir gern, ob eine Umsetzung möglich ist.
      </p>
      <p class="muted">
        Außerdem können wir komplette Kollektionen für dich <strong>nachbilden</strong> oder gemeinsam <strong>neue Kollektionen entwickeln und produzieren</strong>.
        Ob Einzelartikel oder Full-Service &ndash; bei uns bist du richtig.
      </p>
    </article>
  </section>
</main>

<footer>
  <div class="wrap">
    <small>© <span id="y"></span> CoreWear</small>
    <div style="display:flex;gap:14px">
      <a href="/de/legal/">Impressum</a>
      <a href="/de/privacy/">Datenschutz</a>
    </div>
  </div>
</footer>

<!-- Lightbox -->
<div class="lightbox" hidden aria-hidden="true" role="dialog" aria-label="Bildvorschau">
  <button class="lb-close" type="button" aria-label="Schließen">×</button>
  <button class="lb-btn lb-prev" type="button" aria-label="Vorheriges Bild">‹</button>
  <img class="lb-img" alt="Vorschau">
  <button class="lb-btn lb-next" type="button" aria-label="Nächstes Bild">›</button>
</div>

<script>
/* =====================================
   Footer-Jahr
===================================== */
(function(){
  const y = document.getElementById('y');
  if (y) y.textContent = new Date().getFullYear();
})();

/* =====================================
   Bildpfad-Utils (AVIF/WebP/PNG für Karten) + AVIF/WebP/JPG für Beispielbilder
   Basis relativ zu /de/products/  =>  ../resources/img/Clothes
   (Wie EN-Seite: parser-gesteuertes Laden via <picture>)
===================================== */
const IMG_BASE = "../resources/img/Clothes";

function encodePathSegment(seg){
  return encodeURIComponent(seg).replace(/%2F/gi, "/");
}
function buildImgPath(dir, baseName, ext){
  const safeDir  = dir.split("/").map(encodePathSegment).join("/");
  const safeFile = encodePathSegment(baseName) + "." + ext;
  return `${IMG_BASE}/${safeDir}/${safeFile}`;
}
function buildAllImgPaths(dir, baseName){
  return {
    avif: buildImgPath(dir, baseName, "avif"),
    webp: buildImgPath(dir, baseName, "webp"),
    png:  buildImgPath(dir, baseName, "png")
  };
}

// ▶️ Beispielbilder: AVIF → WebP → JPG
// Pfade: .../{dir}/{baseName}/{baseName}{index}.{ext}
function buildExamplePaths(dir, baseName, index){
  const safeDir   = dir.split("/").map(encodePathSegment).join("/");
  const folder    = encodePathSegment(baseName);
  const root      = encodePathSegment(baseName) + String(index);
  const base      = `${IMG_BASE}/${safeDir}/${folder}/${root}`;
  return { avif: `${base}.avif`, webp: `${base}.webp`, jpg: `${base}.jpg` };
}
// Optionales Manifest (falls vorhanden): .../{dir}/{baseName}/examples.json
function buildExamplesManifestUrl(dir, baseName){
  const safeDir   = dir.split("/").map(encodePathSegment).join("/");
  const folder    = encodePathSegment(baseName);
  return `${IMG_BASE}/${safeDir}/${folder}/examples.json`;
}

/* =====================================
   Mobile Scroll Helpers
===================================== */
const MOBILE_MAX = 959.98; // identisch zu deinem CSS-Breakpoint
function isMobile(){ return window.matchMedia(`(max-width:${MOBILE_MAX}px)`).matches; }
function getHeaderHeight(){
  const val = getComputedStyle(document.documentElement).getPropertyValue('--header-h').trim();
  const n = parseFloat(val); return Number.isFinite(n) ? n : 64;
}
function scrollToPanel(panelEl){
  if(!panelEl) return;
  const y = panelEl.getBoundingClientRect().top + window.scrollY - getHeaderHeight() - 10;
  window.scrollTo({ top: y, behavior: 'smooth' });
}

/* =====================================
   Kategorien & Details
===================================== */
const CATEGORIES = [
  {
    title: "Oberteile",
    dir: "Oberteile",
    items: [
      { de:"Blusen" },
      { de:"Hoodies" },
      { de:"Poloshirts" },
      { de:"Hemden" },
      { de:"Pullover" },
      { de:"Sweatshirts" },
      { de:"Tanktops" },
      { de:"Tops" },
      { de:"T-Shirts" },
      { de:"Westen" }
    ]
  },
  {
    title: "Unterteile",
    dir: "Unterteile",
    items: [
      { de:"Chinos" },
      { de:"Anzughosen" },
      { de:"Jeans" },
      { de:"Jogginghosen" },
      { de:"Leggings" },
      { de:"Maxiröcke" },
      { de:"Midiröcke" },
      { de:"Miniröcke" },
      { de:"Shorts" }
    ]
  },
  {
    title: "Business- & Arbeitskleidung",
    dir: "Business- & Arbeitskleidung",
    items: [
      { de:"Latzhosen" },
      { de:"Overall (Herren)" },
      { de:"Schutzhosen" },
      { de:"Sicherheitswesten" },
      { de:"Anzüge (Sakko+Hose)" },
      { de:"Overall (Damen)" },
      { de:"Damenanzüge (Blazer+Hose)" },
      { de:"Damenanzüge (Blazer+Rock)" },
      { de:"Arbeitsjacken" }
    ]
  },
  {
    title: "Kleider",
    dir: "Kleider",
    items: [
      { de:"Businesskleider" },
      { de:"Cocktailkleider" },
      { de:"Abendkleider" },
      { de:"Maxikleider" },
      { de:"Etuikleider" },
      { de:"Sommerkleider" }
    ]
  },
  {
    title: "Sport- & Freizeitkleidung",
    dir: "Sport- & Freizeitkleidung",
    items: [
      { de:"Baseballtrikots" },
      { de:"Football-Trikots" },
      { de:"Fußballtrikots" },
      { de:"Radlerhosen" },
      { de:"Jogginganzüge" },
      { de:"Funktionsshirts" },
      { de:"Sport-BHs" },
      { de:"Trainingsanzüge" }
    ]
  },
  {
    title: "Jacken & Mäntel",
    dir: "Jacken & Mäntel",
    items: [
      { de: "Bomberjacken" },
      { de: "Daunenjacken" },
      { de: "Freizeitjacken" },
      { de: "Jeansjacken" },
      { de: "Lederjacken" },
      { de: "Parkas" },
      { de: "Regenjacken" },
      { de: "Trenchcoats" },
      { de: "Windbreakers" },
      { de: "Winterjacken" }
    ]
  },
  {
    title: "Kinderbekleidung",
    dir: "Kinderbekleidung",
    items: [
      { de:"Baby-Bodys" },
      { de:"Jungen-Schuluniformen" },
      { de:"Mädchen-Schuluniformen" },
      { de:"Kinderjacken" },
      { de:"Kinder-T-Shirts" },
      { de:"Strampler" }
    ]
  },
  {
    title: "Haushalt",
    dir: "Haushalt",
    items: [
      { de:"Bademäntel", file:"Bademäntel" },
      { de:"Handtücher", file:"Handtücher" },
      { de:"Badevorleger", file:"Badevorleger" },
      { de:"Bettdecken", file:"Bettdecken" },
      { de:"Kissenbezüge", file:"Kissenbezüge" },
      { de:"Bettlaken", file:"Bettlaken" },
      { de:"Tischdecken", file:"Tischdecken" },
      { de:"Servietten", file:"Servietten" },
      { de:"Sonstiges", file:"Sonstiges" }
    ]
  }
];

const ITEM_DETAILS = {
  // ---------- Oberteile ----------
  "Blusen": {
    fabrics: ["Feingewebe: Viskose, TENCEL™ Lyocell, Crepe de Chine (90&ndash;140 GSM)"],
    methods: ["Feine Kapp-/Französische Nähte", "Knopfleisten, Paspel-Details", "Lockere/taillierte Passform"],
    notes: ["Weicher Fall, geringe Knitterneigung", "Option: verdeckte Knopfleiste, Rüschen, Manschettenvarianten"]
  },
  "Hoodies": {
    fabrics: ["Fleece 300&ndash;420 GSM (gebürstet)", "French Terry 280&ndash;360 GSM"],
    methods: ["Coverstitch-Nähte", "Kängurutasche, Kapuzenfutter", "Rippe an Saum & Ärmel"],
    notes: ["Heavyweight Streetwear möglich", "Druck/Stick großflächig, Reißverschluss optional"]
  },
  "Poloshirts": {
    fabrics: ["Piqué 180&ndash;240 GSM (Baumwolle/Poly)", "Interlock 170&ndash;210 GSM"],
    methods: ["Knopfleiste mit Verstärkung", "Kragen mit Einlage", "Saum-Schlitze mit Bartack"],
    notes: ["Corporate Wear tauglich", "Option: Kontrastkragen/-bündchen, Sticklogo"]
  },
  "Hemden": {
    fabrics: ["Popeline, Oxford, Twill (110&ndash;160 GSM)"],
    methods: ["Kragenvarianten (Kent, Button-down)", "Brusttasche optional", "Saubere Innenverarbeitung"],
    notes: ["Slim/Regular/Relaxed Fit", "Option: bügelleicht, Easy-Iron-Finish"]
  },
  "Pullover": {
    fabrics: ["Wollmischungen (Merino/Poly)", "Baumwoll-Strick, Feinstrick"],
    methods: ["Fully-Fashioned Linking", "Rippenbündchen 1x1/2x2", "Raglan/Set-in Ärmel"],
    notes: ["Edel, formstabil", "Option: Wascheffekte, Strukturstrick"]
  },
  "Sweatshirts": {
    fabrics: ["French Terry 260&ndash;340 GSM", "Loopback Jersey"],
    methods: ["Flatlock-Nähte", "Set-in/Raglan", "Gerippte Bündchen"],
    notes: ["Print/Stick, Applikationen", "Klassische Streetwear-Silhouetten"]
  },
  "Tanktops": {
    fabrics: ["Single Jersey 160&ndash;200 GSM", "Performance-Jersey (Poly)"],
    methods: ["Ein/zweifach eingefasste Kanten", "Armloch-/Halsausschnitt Binding"],
    notes: ["Sport/Layering", "Option: Racerback, Loose Fit"]
  },
  "Tops": {
    fabrics: ["Modal-/Viskose-Jersey", "Rib Jersey 180&ndash;220 GSM"],
    methods: ["Coverstitch-Säume", "Nahtverdeckter Reißverschluss (elegant)"],
    notes: ["Basic bis Fashion", "Option: Cropped, Cut-Outs"]
  },
  "T-Shirts": {
    fabrics: ["Single Jersey 160&ndash;220 GSM (Bio-Cotton möglich)"],
    methods: ["Tubular oder Seitennähte", "Nackenband, Schulter-to-Schulter-Tape"],
    notes: ["Oversize/Boxy möglich", "Reaktive Drucke, DTG, DTF, Siebdruck"]
  },
  "Westen": {
    fabrics: ["Stepp: Nylon/Poly mit Wattierung", "Fleece-Weste 220&ndash;300 GSM"],
    methods: ["Reißverschluss vorn, Kinnschutz", "Steppmuster: horizontal/diamant"],
    notes: ["Leicht, Layering-fähig", "Option: Softshell-Weste, wasserabweisend"]
  },

  // ---------- Unterteile ----------
  "Chinos": {
    fabrics: ["Stretch-Twill 240&ndash;300 GSM", "Baumwolle/Elasthan"],
    methods: ["Bund mit Gürtelschlaufen", "Hosen-Haken, Paspeltaschen hinten"],
    notes: ["Business-Casual", "Option: Tapered/Regular Fit"]
  },
  "Anzughosen": {
    fabrics: ["Feiner Woll-/Poly-Mix", "Gabardine, Twill (200&ndash;260 GSM)"],
    methods: ["Bügelbruch, Futter bis Knie", "Hosenhaken+Knopf, Saum mit Stoßband"],
    notes: ["Anzugskompatibel", "Option: Stoff-Garnituren passend zum Sakko"]
  },
  "Jeans": {
    fabrics: ["Denim 11&ndash;14 oz (Baumwolle/Elasthan)"],
    methods: ["Kettenstich-Nähte, Nieten", "YKK-Zip oder Button-Fly"],
    notes: ["Stone/Enzyme-Wash möglich", "Passformen: Skinny bis Loose"]
  },
  "Jogginghosen": {
    fabrics: ["French Terry 280&ndash;340 GSM", "Tech-Jersey (Sport)"],
    methods: ["Elastikbund mit Kordel", "Rippenbündchen am Saum"],
    notes: ["Sport/Streetwear", "Option: Seitentaschen mit Zipper"]
  },
  "Leggings": {
    fabrics: ["Hochstretch-Interlock 220&ndash;280 GSM", "Nylon/Spandex, squat-proof"],
    methods: ["Flachnähte (Flatlock) gegen Reibung", "Breiter Formbund"],
    notes: ["Performance-Einsatz", "Option: Handy-Tasche seitlich"]
  },
  "Maxiröcke": {
    fabrics: ["Viskose-Crêpe, Satin", "Jersey (casual)"],
    methods: ["Verdeckter Reißverschluss/Elastikbund", "Saubere Säume"],
    notes: ["Fließender Fall", "Option: Schlitz, Print allover"]
  },
  "Midiröcke": {
    fabrics: ["Satin/Crepe 120&ndash;180 GSM", "Strukturgewebe"],
    methods: ["Formbund, Abnäher", "Innenfutter optional"],
    notes: ["Business/Fashion", "Option: A-Linie/Plissee"]
  },
  "Miniröcke": {
    fabrics: ["Twill/Denim", "Kunstleder (Fashion)"],
    methods: ["Abnäher, Reißverschluss hinten/seitlich", "Saum fixiert oder raw edge (Denim)"] ,
    notes: ["Trend-Piece", "Option: Gürtel/Ösen-Details"]
  },
  "Shorts": {
    fabrics: ["Twill/Chino", "French Terry (Casual)"],
    methods: ["Bund: Elastik+Kordel oder Haken", "Taschen: Schräg vorn, Paspel hinten"],
    notes: ["Sommer/Teamwear", "Option: Kontrastnähte, Prints"]
  },

  // ---------- Business & Arbeitskleidung ----------
  "Latzhosen": {
    fabrics: ["Heavy Twill 300&ndash;360 GSM", "Poly/Cotton 65/35"],
    methods: ["Dreifachnähte, Knieverstärkung", "Mehrfach-Werkzeugtaschen"],
    notes: ["Robust & langlebig", "Option: Reflektpaspeln, Stretch-Einsätze"]
  },
  "Overall (Herren)": {
    fabrics: ["Twill/Canvas 260&ndash;320 GSM"],
    methods: ["Front-Zip, Elastik im Rücken", "Cordura®-Verstärkungen optional"],
    notes: ["Industrie-geeignet", "Option: Namenspatch, Firmenbranding"]
  },
  "Schutzhosen": {
    fabrics: ["Ripstop, Twill, Mischgewebe", "Optional: schwer entflammbar (Norm)"],
    methods: ["Dreifachnähte, Kniepolster-Fächer", "Reflex-Bänder"],
    notes: ["Normen nach Briefing (z. B. EN ISO)", "Hohe Abriebfestigkeit"]
  },
  "Sicherheitswesten": {
    fabrics: ["Hi-Vis Mesh/Trikot", "Reflextransfer-Bänder zertifiziert"],
    methods: ["Bindung/Umkettelung Kanten", "Klett-Verschluss vorn"],
    notes: ["Neonfarben EN-konform", "Option: Großflächiger Rücken-Print"]
  },
  "Anzüge (Sakko+Hose)": {
    fabrics: ["Wolle/Poly/Elasthan", "Feine Garne, Fall 200&ndash;260 GSM"],
    methods: ["Halb-/Vollcanvas möglich", "AMF-Stich, Innenfutter & Paspeltaschen"],
    notes: ["Maßtabellen & Gradierung", "Serienfertigung Business-Qualität"]
  },
  "Overall (Damen)": {
    fabrics: ["Crepe/Poly-Mix", "Stretch-Twill für bequeme Passform"],
    methods: ["Taillierung, verdeckter Zip", "Gürtel/Bindeband möglich"],
    notes: ["Business bis Fashion", "Option: weites Bein, Culotte-Form"]
  },
  "Damenanzüge (Blazer+Hose)": {
    fabrics: ["Woll-/Poly-Stretch", "Kammgarn-Optik"],
    methods: ["Taillierter Blazer, Futter", "Zigarettenhose mit Bügelfalte"],
    notes: ["Feminine Schnittführung", "Option: Farben nach CI"]
  },
  "Damenanzüge (Blazer+Rock)": {
    fabrics: ["Woll-/Poly-Mix", "Feine Strukturgewebe"],
    methods: ["Blazer mit Revers, Rock bis Knie", "Innenfutter, Paspel"],
    notes: ["Business-Set", "Option: Rock Bleistift/ausgestellt"]
  },
  "Arbeitsjacken": {
    fabrics: ["Twill/Softshell", "Fleece-Futter optional"],
    methods: ["Verstärkte Ellenbogen", "Mehr-Taschen, Reißverschlusstaschen"],
    notes: ["Robuste Reißverschlüsse", "Option: Reflexelemente, Branding"]
  },

  // ---------- Kleider ----------
  "Businesskleider": {
    fabrics: ["Ponte Roma, Scuba-Knit", "Viskose-Mischung"],
    methods: ["Abnäher, figurbetont", "Nahtverdeckter Zip, Futter optional"],
    notes: ["Knielang klassisch", "Option: 3/4-Ärmel, Schlitze"]
  },
  "Cocktailkleider": {
    fabrics: ["Satin, Crepe, Spitze"],
    methods: ["Futter, Nahtband", "Zierdetails: Rüschen, Drapierung"],
    notes: ["Event-tauglich", "Option: Glitzer/Applikationen"]
  },
  "Abendkleider": {
    fabrics: ["Chiffon, Satin, Seidenoptik"],
    methods: ["Mehrlagig, Futter", "Reichere Verarbeitung, Korsage möglich"],
    notes: ["Bodenlang", "Option: Perlenstickerei, Schlitz"]
  },
  "Maxikleider": {
    fabrics: ["Viskose, Rayon, leichte Gewebe"],
    methods: ["Gummizug in Taille", "Knopfleiste/Bindeband"],
    notes: ["Fließend & luftig", "Option: Allover-Print"]
  },
  "Etuikleider": {
    fabrics: ["Strukturstoffe, Stretch-Crepe"],
    methods: ["Etuiform, Abnäher", "Nahtverdeckter Zip hinten"],
    notes: ["Business-elegant", "Option: Farb-Piping"]
  },
  "Sommerkleider": {
    fabrics: ["Baumwolle/Leinen leicht", "Viskose-Jersey"],
    methods: ["Trägervarianten, Knöpfe", "Saum-Volants optional"],
    notes: ["Atmungsaktiv", "Option: AOP-Print, Stickerei"]
  },

  // ---------- Sport & Freizeit ----------
  "Baseballtrikots": {
    fabrics: ["Poly Mesh/Interlock"],
    methods: ["Knopfleiste vorn", "Kontrastpaspel, Team-Applikationen"],
    notes: ["Nummern/Namen individualisierbar", "Sublimation oder Flock möglich"]
  },
  "Football-Trikots": {
    fabrics: ["Robustes Poly-Mesh"],
    methods: ["Verstärkte Schulternähte", "Breite Ärmel für Pads"],
    notes: ["Teamfarben & Logos", "Nummern vorne/hinten/Ärmel"]
  },
  "Fußballtrikots": {
    fabrics: ["Leichter Poly-Interlock"],
    methods: ["Atmungsaktive Einsätze", "Raglan/Set-in möglich"],
    notes: ["Schnelltrocknend", "Individuelle Club-Designs"]
  },
  "Radlerhosen": {
    fabrics: ["Kompressionsstoff 220&ndash;260 GSM"],
    methods: ["Flatlock-Nähte", "Sitzpolster (Mehrdichte)"],
    notes: ["Rutschfeste Beinabschlüsse", "Reflekt-Details optional"]
  },
  "Jogginganzüge": {
    fabrics: ["French Terry 300&ndash;360 GSM"],
    methods: ["Hoodie+Jogger Set", "Kordeln, Metallösen"],
    notes: ["Street & Team", "Option: Allover-Print Panel"]
  },
  "Funktionsshirts": {
    fabrics: ["Mikrofaser-Poly, antibakteriell"],
    methods: ["Nahtarm (Raglan)", "Flachnähte"],
    notes: ["Feuchtetransport", "Option: Mesh-Panels"]
  },
  "Sport-BHs": {
    fabrics: ["Nylon/Spandex Kompression"],
    methods: ["Doppellagig, Gummibund", "Herausnehmbare Pads"],
    notes: ["Low/Mid/High Support Optionen", "Verstärkte Träger"]
  },
  "Trainingsanzüge": {
    fabrics: ["Poly-Trikot", "Warmes Knit für Winter"],
    methods: ["Jacke+Hose, Reißverschlüsse", "Kontrast-Paspeln"],
    notes: ["Teamwear", "Nummern/Logos möglich"]
  },

  /* ---------- Jacken & Mäntel ---------- */
  "Bomberjacken": {
    fabrics: [
      "Nylon/Oxford 70&ndash;120 D, optional mit PU/DWR-Beschichtung",
      "Polyester-Twill 150&ndash;220 GSM, Futter: Taft 60&ndash;80 GSM",
      "Wattierung 80&ndash;150 GSM (Poly) &ndash; leicht bis mittelwarm"
    ],
    methods: [
      "Rippenbündchen an Kragen/Ärmel/Saum (1x1/2x2)",
      "Front-Zip (YKK) mit Windleiste, Kinnschutz",
      "Ärmeltasche mit Reißverschluss + Stiftkanälen (MA-1-Style)"
    ],
    notes: [
      "Steppkammern horizontal/diamant möglich",
      "Innen-/Außentaschen mit Druckknopf oder Zip",
      "Option: reversible, Flight-Tag, großflächiger Stick/Print"
    ]
  },

  "Daunenjacken": {
    fabrics: [
      "Downproof-Nylon 20&ndash;40 D (calendered), DWR",
      "Futter: ultraleichter Taft 20&ndash;30 D",
      "Füllung: 90/10 Daune/Feder oder Synthetik 120&ndash;250 GSM"
    ],
    methods: [
      "Kammern: gesteppte Baffles oder Box-Wände",
      "Elastische Innenbündchen, verstellbare Kapuze",
      "Option: versiegelte Nähte im Schulterbereich"
    ],
    notes: [
      "RDS-zertifizierte Daunen auf Wunsch, Fill-Power z. B. 650+",
      "DWR-Finish nachrüstbar, wasserabweisend",
      "Packbar in Innentasche; Gewicht & Wärmegrad nach Briefing"
    ]
  },

  "Freizeitjacken": {
    fabrics: [
      "Baumwoll-/Poly-Twill 200&ndash;260 GSM",
      "Softshell 280&ndash;320 GSM (atmungsaktiv, leicht wasserabweisend)",
      "Ungefüttert oder Teilfutter (Mesh/Taft 60&ndash;80 GSM)"
    ],
    methods: [
      "Front-Zip oder Druckknopfleiste",
      "Eingrifftaschen mit Paspel/Klappe",
      "Stehkragen/Umlegekragen, formstabile Belege"
    ],
    notes: [
      "Übergangsjacke; bequeme Regular/Oversize-Fits",
      "Option: Kordel in Saum/Kapuze, elastische Manschetten",
      "CI-Branding via Stick, DTF, Lederpatch"
    ]
  },

  "Jeansjacken": {
    fabrics: [
      "Denim 11&ndash;14 oz (100 % CO oder CO/Elasthan)",
      "Twill-Futter optional (Körper) oder Sherpa-Futter 250&ndash;350 GSM",
      "Kontrastgarne Core-Spun 20/3"
    ],
    methods: [
      "Kapp-/Doppelnähte, Riegel-/Bartacks an Belastungspunkten",
      "Metall-Druckknöpfe/Shank-Buttons, Brusttaschen mit Klappe",
      "Waschungen: Stone/Enzyme, Bleach, Vintage"
    ],
    notes: [
      "Passformen: Classic/Boxy/Relaxed",
      "Option: abknöpfbares Sherpa-Kragenfutter",
      "Dezente Whiskers/Hand-Sand je nach Look"
    ]
  },

  "Lederjacken": {
    fabrics: [
      "Echtes Leder: Lamm-Nappa 0,7&ndash;1,0 mm / Rindsleder 1,1&ndash;1,3 mm",
      "Veganes Leder (PU/microfiber) 0,6&ndash;0,9 mm",
      "Futter: Satin/Taft 60&ndash;80 GSM, Ärmel ggf. gleitfähig"
    ],
    methods: [
      "Panel-Schnitt mit Ziersteppungen, Kanten gefärbt/versiegelt",
      "Metall-Zipper (YKK Excella) + Druckknöpfe",
      "Revers/Biker-Kragen oder Stehkragen, Schulterstepp möglich"
    ],
    notes: [
      "Gerbung & REACH-Konformität nachweisbar",
      "Vorserie für Passform empfohlen (Leder fällt individuell)",
      "Option: abnehmbares Futter, Prägung/Embossing"
    ]
  },

  "Parkas": {
    fabrics: [
      "Canvas/Oxford 160&ndash;220 GSM mit DWR",
      "Membran-Laminate 2- oder 3-Lagen (5k&ndash;10k mm WS)",
      "Isolierung 120&ndash;200 GSM (Körper höher als Ärmel)"
    ],
    methods: [
      "Lange Form mit Fischteilschlitz, Tunnelzug in Taille",
      "Abnehmbare Kapuze mit Schirm, Storm-Cuffs",
      "Viele Taschen (Cargo/Handwärmer), Windleiste über Frontzip"
    ],
    notes: [
      "Winter- oder Übergangsvariante möglich",
      "Option: Fellimitat-Besatz an Kapuze",
      "Reflex-Piping/Transfers für Work/City"
    ]
  },

  "Regenjacken": {
    fabrics: [
      "2,5-Lagen Laminat 90&ndash;130 GSM (WP 10k, MVP 10k)",
      "3-Lagen Shell 120&ndash;160 GSM für robusten Einsatz",
      "Nylon/Poly mit PFC-freier DWR"
    ],
    methods: [
      "Vollständig getapte Nähte (Heißband)",
      "Wasserabweisende Zipper, Kinnschutz, Laminat-Visier",
      "Unterarm-Ventilations-Zips (Pit-Zips)"
    ],
    notes: [
      "Packbar in eigene Tasche/Beutel",
      "Verstellbare Kapuze, Einhand-Kordelstopper",
      "Option: reflektierende Details, Droptail-Saum"
    ]
  },

  "Trenchcoats": {
    fabrics: [
      "Gabardine 200&ndash;260 GSM (CO/Poly/Elasthan)",
      "Satin-/Twill-Futter 70&ndash;90 GSM (teil- oder vollgefüttert)",
      "Gürtelband mit Einlage"
    ],
    methods: [
      "Doppelreihig, Sturmklappe & Rückenkoller",
      "Epauletten, Ärmelriegel, Gehschlitz hinten",
      "Kragen mit Unterkragen-Filz, Stepp 0,6&ndash;0,8 cm"
    ],
    notes: [
      "Klassische Knopfpositionen & Längen (Knie/Oberschenkel)",
      "Horn-Optik-Knöpfe oder echte Corozo",
      "Option: wasserabweisendes Finish"
    ]
  },

  "Windbreakers": {
    fabrics: [
      "Leichtes Nylon/Taffeta 70&ndash;110 GSM, DWR",
      "Mesh-Futter 60&ndash;80 GSM (Atmungsaktivität)",
      "Ripstop-Variante für mehr Reißfestigkeit"
    ],
    methods: [
      "Gummizug an Saum/Ärmel, Kordel an Kapuze",
      "Front-Zip (1/2 oder full), Kinnschutz",
      "Packbar in Kängurutasche/Seitentasche"
    ],
    notes: [
      "Sehr leicht, ideal für Promotion/Teamwear",
      "Option: reflektierende Paspeln/Logos",
      "Allover-Sublimation oder Panel-Print möglich"
    ]
  },

  "Winterjacken": {
    fabrics: [
      "Robuster Oxford/Canvas 180&ndash;240 GSM mit DWR",
      "Futter: Taft/Quilt, Microfleece im Kragen",
      "Isolierung 180&ndash;300 GSM (zoniert: Körper/Ärmel/Kapuze)"
    ],
    methods: [
      "Mehrlagiger Aufbau mit Windleiste (innen/außen)",
      "Storm-Cuffs, Schneefang optional (urban/outdoor)",
      "Große Taschen: Handwärmer oben, Cargo unten"
    ],
    notes: [
      "Sehr warm; für &minus;5 °C bis &minus;20 °C je nach Füllmenge",
      "Option: 3-in-1 mit herausnehmbarem Innenfleece",
      "Sicherheits-Features: Reflex, Notfallpfeife am Zipper"
    ]
  },

  // ---------- Kinder ----------
  "Baby-Bodys": {
    fabrics: ["Bio-Baumwolle Interlock 180&ndash;220 GSM"],
    methods: ["Nickelfreie Druckknöpfe", "Umschlag-Schultern"],
    notes: ["Hautfreundlich", "Zertifizierungen möglich (z. B. OEKO-TEX)"]
  },
  "Jungen-Schuluniformen": {
    fabrics: ["Poloshirts/Westen: Piqué & Twill"],
    methods: ["Strapazierfähig", "Beschriftungen/Logos"],
    notes: ["Standardisierte Größen", "Serienlieferungen planbar"]
  },
  "Mädchen-Schuluniformen": {
    fabrics: ["Blusen/Röcke: Popeline/Twill"],
    methods: ["Rockfalten, verstellbarer Bund", "Knopfleisten"],
    notes: ["Pflegeleicht", "CI-Farben umsetzbar"]
  },
  "Kinderjacken": {
    fabrics: ["Softshell, Stepp, Fleece"],
    methods: ["Leicht bedienbare Zips", "Reflekt-Details"],
    notes: ["Wetterfest je nach Bedarf", "Option: Namenslabel innen"]
  },
  "Kinder-T-Shirts": {
    fabrics: ["Baumwoll-Jersey 160&ndash;200 GSM"],
    methods: ["Weiche Nähte", "Schulter-to-Schulter-Tape"],
    notes: ["Hautfreundlich", "Prints kindgerecht"]
  },
  "Strampler": {
    fabrics: ["Interlock/Rib", "Hoher Baumwollanteil"],
    methods: ["Front-Zip/Knopfleiste", "Bein-Druckknöpfe"],
    notes: ["Einfaches An-/Ausziehen", "Option: Fußteil geschlossen/offen"]
  },

  // ---------- Haushalt ----------
  "Bademäntel": {
    fabrics: ["Frottier 320&ndash;450 GSM (100% Baumwolle oder Bambus-Viskose-Mix)", "Waffelpikee 220&ndash;300 GSM (leichter)"],
    methods: ["Doppelte Seitennähte/Overlock", "Gürtel, Schlaufen, aufgesetzte Taschen", "Schalkragen oder Kapuze"],
    notes: ["Vorgewaschen gegen Einlaufen", "Option: Sticklogo auf Brust/Ärmel", "Personalisierung (Monogramm) möglich"]
  },
  "Badevorleger": {
    fabrics: ["Frottier 700&ndash;900 GSM (hochflorig)", "Rutschhemmende Unterlage optional (Latex/TPR)"],
    methods: ["Einfassung mit Doppelstepp", "Jacquard- oder Bordürenmuster"],
    notes: ["Hohe Saugfähigkeit", "Option: Anti-Rutsch-Beschichtung", "Standard- & Hotelgrößen verfügbar"]
  },
  "Bettdecken": {
    fabrics: ["Downproof-Baumwollperkal 230&ndash;300 TC", "Mikrofaserhülle 70&ndash;110 GSM"],
    methods: ["Kassetten- oder Boxsteppung", "Paspelierte Kanten, Aufhängeschlaufen"],
    notes: ["Füllungen: Daune/Feder oder Hohlfaser", "Wärmegrade (Sommer/Übergang/Winter)", "Option: waschbar bis 60 °C (Hohlfaser)"]
  },
  "Kissenbezüge": {
    fabrics: ["Baumwollsatin 300&ndash;400 TC", "Perkal 200&ndash;300 TC", "Jersey 160&ndash;190 GSM"],
    methods: ["Hotelverschluss (Überlappung) oder Reißverschluss", "Saum 3 cm, Paspel optional"],
    notes: ["Weich & atmungsaktiv", "Option: Stickereien/Piping", "Standard- & Sondergrößen"]
  },
  "Bettlaken": {
    fabrics: ["Jersey 140&ndash;180 GSM mit Elasthan (Spannbettlaken)", "Perkal/Satin 120&ndash;160 GSM (Flat Sheet)"],
    methods: ["Rundumgummi (Spannbettlaken)", "Doppelte Säume, Miternähte an Ecken"],
    notes: ["Formstabil, sanfter Griff", "Option: Tiefe für hohe Matratzen", "Farbpalette nach CI"]
  },
  "Tischdecken": {
    fabrics: ["Poly/Baumwoll-Mischung 180&ndash;240 GSM", "Fleckschutz-Finish (z. B. Teflon®)"],
    methods: ["Saum 2&ndash;3 cm, gewebte Jacquards", "Gehrungsecken (mitered corners)"],
    notes: ["Pflegeleicht, bügelleicht", "Option: Rund/Oval/Sondermaße", "Logo-Weaving/Allover möglich"]
  },
  "Servietten": {
    fabrics: ["Baumwolle/Twill 180&ndash;220 GSM", "Damast/Jacquard für Gastronomie"],
    methods: ["Schmaler Saum 1&ndash;1,5 cm", "Gehrungsecken, Doppelstepp"],
    notes: ["Hohe Faltstabilität", "Option: Logo-Stick, Kettelrand", "Sets passend zur Tischdecke"]
  }
};

/* =====================================
   Lazy Loader mit Queue (max 8 parallel)
   + IntersectionObserver
   👉 Für BEISPIELBILDER (jetzt mit <picture> & AVIF/WebP/JPG)
===================================== */
const PLACEHOLDER_1PX =
  "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR4nGMAAQAABQABDQottQAAAABJRU5ErkJggg==";

class ImageQueue {
  constructor(max=8){
    this.max = max;
    this.running = 0;
    this.q = [];
  }
  add(task){ this.q.push(task); this.run(); }
  run(){
    while(this.running < this.max && this.q.length){
      const t = this.q.shift();
      this.running++;
      Promise.resolve().then(t).catch(()=>{}).finally(()=>{
        this.running--;
        this.run();
      });
    }
  }
}
const loaderQueue = new ImageQueue(8);

// ⬇️ IO lädt jetzt <picture>-Quellen (data-srcset) + <img data-src>
const io = ('IntersectionObserver' in window)
  ? new IntersectionObserver((entries)=>{
      entries.forEach(entry=>{
        if(!entry.isIntersecting) return;
        const el = entry.target;
        io.unobserve(el);

        // IMG in <picture>
        if (el.tagName === 'IMG') {
          loaderQueue.add(async ()=>{
            // Quellen in <picture> aktivieren (nur vorhandene)
            const pic = el.parentElement && el.parentElement.tagName === 'PICTURE' ? el.parentElement : null;
            if (pic) {
              const sources = pic.querySelectorAll('source[data-srcset]');
              sources.forEach(s => {
                s.srcset = s.dataset.srcset;
                s.removeAttribute('data-srcset');
              });
            }
            const url = el.dataset.src;
            if(url){
              const preload = new Image();
              preload.decoding = 'async';
              preload.src = url;
              try { await preload.decode(); } catch {}
              el.src = url; // jpg Fallback; Browser nimmt dank <source> bevorzugt AVIF/WebP
              el.removeAttribute('data-src');
              el.classList.add('loaded');
            }
          });
        }
      });
    }, { rootMargin: '200px' })
  : null;

/* =====================================
   Rendering der Karten
   👉 wie EN: <picture> mit AVIF/WebP/PNG (ohne Lazy-Queue)
   (Beispielbilder nutzen IO/Queue)
===================================== */
const rowsWrap = document.querySelector('.product-rows');

function createRow(cat, index){
  const row = document.createElement('section');
  row.className = 'category-row';
  row.dataset.catIndex = index;

  row.innerHTML = `
    <div class="row-head">
      <h3>${cat.title.replace('&', '&amp;')}</h3>
    </div>
    <div class="row-items"></div>
    <div class="info-slot"></div>
  `;

  const itemsWrap = row.querySelector('.row-items');

  cat.items.forEach((it) => {
    const baseName = it.file || it.de;
    const urls = buildAllImgPaths(cat.dir, baseName);

    const card = document.createElement('button');
    card.className = 'product-card';
    card.type = 'button';

    // <picture> mit AVIF/WebP und PNG-Fallback
    const picture = document.createElement('picture');
    picture.innerHTML = `
      <source type="image/avif" srcset="${urls.avif}">
      <source type="image/webp" srcset="${urls.webp}">
      <img src="${urls.png}" alt="${it.de}">
    `;

    // Zusätzliche JS-Fallback-Kaskade, falls bestimmte Dateien fehlen (404)
    const imgEl = picture.querySelector('img');
    let triedWebp = false;
    let triedPng = true; // wir starten schon mit PNG als src
    imgEl.addEventListener('error', () => {
      // Fallback auf WebP → PNG (für Karten; Karten nutzen PNG statt JPG)
      if (!triedWebp) {
        triedWebp = true;
        imgEl.src = urls.webp;
        return;
      }
      if (!triedPng) {
        triedPng = true;
        imgEl.src = urls.png;
        return;
      }
    });

    card.appendChild(picture);

    const title = document.createElement('span');
    title.className = 'pc-title';
    title.textContent = it.de;

    card.appendChild(title);

    // Klick → Details rendern + mobiles Scrollen
    card.addEventListener('click', (e) => {
      const panel = showInfoInline(cat, it, row);
      if (isMobile()) {
        scrollToPanel(panel);
      }
    });

    itemsWrap.appendChild(card);
  });

  return row;
}

/* =====================================
   Beispielbilder-Logik: On-Demand (ROBUSTE FALLBACKS)
   - Manifest unterstützt Zahlen ODER Dateinamen
   - Für jeden Eintrag wird per HEAD geprüft, welche Formate existieren
   - Rendering setzt nur vorhandene <source>-Formate
   - onerror-Kaskade: AVIF → WebP → JPG
===================================== */
const MAX_EXAMPLES = 24;
const STOP_AFTER_MISSES = 1; // bei erster Lücke abbrechen
// Cache speichert Array von Items: { avif?:string, webp?:string, jpg?:string }
const exampleCache = new Map(); // key: `${dir}///${baseName}` => Array<...>

async function headExists(url){
  try{
    const res = await fetch(url, { method: 'HEAD' });
    return !!(res && res.ok);
  }catch{ return false; }
}

// Hilfsfunktion: aus Dateinamen beliebiger Endung (oder root) Pfad-Basis bilden
function tripletFromRoot(dir, baseName, rootName){
  const safeDir   = dir.split("/").map(encodePathSegment).join("/");
  const folder    = encodePathSegment(baseName);
  const rootNoExt = rootName.replace(/\.(avif|webp|jpe?g|png)$/i,'');
  const base      = `${IMG_BASE}/${safeDir}/${folder}/${encodePathSegment(rootNoExt)}`;
  return { avif: `${base}.avif`, webp: `${base}.webp`, jpg: `${base}.jpg` };
}

async function tryLoadExamplesFromManifest(dir, baseName){
  const url = buildExamplesManifestUrl(dir, baseName);
  try{
    const res = await fetch(url, { method: 'GET' });
    if(!res.ok) return null;
    const data = await res.json();
    if(!Array.isArray(data) || data.length === 0) return [];
    const list = [];
    for(const entry of data){
      let t;
      if(typeof entry === 'number'){
        t = buildExamplePaths(dir, baseName, entry);
      } else if(typeof entry === 'string'){
        t = tripletFromRoot(dir, baseName, entry);
      } else {
        continue;
      }
      // Existenz je Format prüfen
      /* eslint-disable no-await-in-loop */
      const hasAvif = await headExists(t.avif);
      const hasWebp = hasAvif ? false : await headExists(t.webp);
      const hasJpg  = (hasAvif || hasWebp) ? false : await headExists(t.jpg);
      if (hasAvif || hasWebp || hasJpg) {
        list.push({
          avif: hasAvif ? t.avif : undefined,
          webp: hasWebp ? t.webp : undefined,
          jpg:  hasJpg  ? t.jpg  : undefined
        });
      }
    }
    return list;
  }catch{ return null; }
}

async function discoverExampleUrls(dir, baseName){
  const cacheKey = `${dir}///${baseName}`;
  if(exampleCache.has(cacheKey)) return exampleCache.get(cacheKey);

  // 1) Manifest versuchen
  let items = await tryLoadExamplesFromManifest(dir, baseName);
  if(items && items.length){
    exampleCache.set(cacheKey, items);
    return items;
  }
  if(items && items.length === 0){
    exampleCache.set(cacheKey, []);
    return [];
  }

  // 2) Fallback: numerisch 1..MAX_EXAMPLES prüfen (HEAD) mit Format-Priorität
  items = [];
  let misses = 0;
  for(let i=1; i<=MAX_EXAMPLES; i++){
    const t = buildExamplePaths(dir, baseName, i);
    /* eslint-disable no-await-in-loop */
    const hasAvif = await headExists(t.avif);
    const hasWebp = hasAvif ? false : await headExists(t.webp);
    const hasJpg  = (hasAvif || hasWebp) ? false : await headExists(t.jpg);

    if(hasAvif || hasWebp || hasJpg){
      items.push({
        avif: hasAvif ? t.avif : undefined,
        webp: hasWebp ? t.webp : undefined,
        jpg:  hasJpg  ? t.jpg  : undefined
      });
      misses = 0;
    } else {
      misses++;
      if(misses >= STOP_AFTER_MISSES) break;
    }
  }
  exampleCache.set(cacheKey, items);
  return items;
}

function removePictureSources(pic){
  if (!pic) return;
  const sources = pic.querySelectorAll('source');
  sources.forEach(s => s.remove());
}

async function mountExamplesOnDemand(dir, baseName, listEl, galleryWrap){
  // Items ermitteln (Manifest oder HEAD); lädt noch KEINE Bilder
  const items = await discoverExampleUrls(dir, baseName);

  if(!items || items.length === 0){
    // Galerie sichtbar lassen und leeren Zustand anzeigen
    galleryWrap.style.display = '';
    listEl.innerHTML = `
      <div class="eg-empty" role="status" aria-live="polite">
        Zu diesem Produkt haben wir noch keine Beispielbilder.
      </div>
    `;
    return;
  }

  // Rendern: Bilder als <picture> mit data-srcset/data-src, lazy via IO
  items.forEach((t, idx) => {
    const li  = document.createElement('div');
    li.className = 'eg-item';

    const picture = document.createElement('picture');

    // Nur vorhandene Formate als <source> vormerken
    if (t.avif){
      const sAvif = document.createElement('source');
      sAvif.type = 'image/avif';
      sAvif.setAttribute('data-srcset', t.avif);
      picture.appendChild(sAvif);
    }
    if (t.webp){
      const sWebp = document.createElement('source');
      sWebp.type = 'image/webp';
      sWebp.setAttribute('data-srcset', t.webp);
      picture.appendChild(sWebp);
    }

    const img = document.createElement('img');
    img.alt = `${baseName} Beispiel`;
    img.src = PLACEHOLDER_1PX; // echter Start-Placeholder
    // Basis-Fallback in data-src: nimm bevorzugt JPG, sonst WebP, sonst AVIF
    const baseFallback = t.jpg || t.webp || t.avif;
    if (baseFallback) img.setAttribute('data-src', baseFallback);
    img.decoding = 'async';
    img.loading = 'lazy';
    img.setAttribute('fetchpriority', 'low');
    img.tabIndex = 0;
    img.setAttribute('role', 'button');
    img.setAttribute('aria-label', 'Bild groß anzeigen');

    // Merke, was wir als nächstes testen sollen (für onerror)
    img.dataset.tryFmt = t.avif ? 'avif' : (t.webp ? 'webp' : 'jpg');

    // onerror-Kaskade: AVIF → WebP → JPG
    img.addEventListener('error', () => {
      const pic = img.parentElement && img.parentElement.tagName === 'PICTURE' ? img.parentElement : null;
      const cur = img.dataset.tryFmt || '';
      if (cur === 'avif') {
        // AVIF fehlgeschlagen → WebP oder JPG
        removePictureSources(pic); // verhindere erneutes AVIF-Pick
        if (t.webp) {
          img.dataset.tryFmt = 'webp';
          img.src = t.webp;
        } else if (t.jpg) {
          img.dataset.tryFmt = 'jpg';
          img.src = t.jpg;
        }
      } else if (cur === 'webp') {
        // WebP fehlgeschlagen → JPG
        removePictureSources(pic);
        if (t.jpg) {
          img.dataset.tryFmt = 'jpg';
          img.src = t.jpg;
        }
      }
    });

    const open = (ev) => {
      ev.preventDefault();
      openLightbox(items, idx, img);
    };
    img.addEventListener('click', open);
    img.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' || e.key === ' ') open(e);
    });

    picture.appendChild(img);
    li.appendChild(picture);
    listEl.appendChild(li);

    if (io) {
      io.observe(img);
    } else {
      // Kein IO: Quellen sofort aktivieren
      const sources = picture.querySelectorAll('source[data-srcset]');
      sources.forEach(s => { s.srcset = s.dataset.srcset; s.removeAttribute('data-srcset'); });
      if (baseFallback) {
        img.src = baseFallback;
        img.classList.add('loaded');
      }
    }
  });
}

function showInfoInline(cat, item, rowEl){
  const key = item.file || item.de;
  const det = ITEM_DETAILS[key] || {};

  const fabrics = det.fabrics || [];
  const methods = det.methods || [];
  const notes   = det.notes   || [];

  const panel = document.createElement('article');
  panel.className = 'card info-inline';
  panel.innerHTML = `
    <div class="info-inline-head">
      <h3>${item.de}</h3>
    </div>
    <div class="info-grid">
      <div>
        <h4>Stoffe</h4>
        <ul>${fabrics.length ? fabrics.map(f => `<li>${f}</li>`).join('') : '<li>Nach Briefing</li>'}</ul>
      </div>
      <div>
        <h4>Produktion</h4>
        <ul>${methods.length ? methods.map(m => `<li>${m}</li>`).join('') : '<li>Nach Briefing</li>'}</ul>
      </div>
      <div>
        <h4>Besonderheiten</h4>
        <ul>${notes.length ? notes.map(n => `<li>${n}</li>`).join('') : '<li>Nach Briefing</li>'}</ul>
      </div>
    </div>

    <div class="example-gallery" aria-live="polite">
      <h4>Beispiele unserer Partner</h4>
      <div class="eg-list"></div>
    </div>
  `;

  const slot = rowEl.querySelector('.info-slot');
  slot.innerHTML = '';
  slot.appendChild(panel);

  // Galerie NACH dem Einfügen lazy initialisieren (on-demand)
  const galleryWrap = panel.querySelector('.example-gallery');
  const listEl = panel.querySelector('.eg-list');
  mountExamplesOnDemand(cat.dir, key, listEl, galleryWrap);

  // A11y: Fokus kurz auf die Überschrift
  const h3 = panel.querySelector('.info-inline-head h3');
  if (h3) {
    h3.setAttribute('tabindex', '-1');
    h3.focus({ preventScroll: true });
  }
  return panel;
}

// Starte Rendering
CATEGORIES.forEach((c, i) => rowsWrap.appendChild(createRow(c, i)));

/* =====================================
   Scroll Restoration
===================================== */
if ('scrollRestoration' in history) {
  history.scrollRestoration = 'manual';
}

/* =====================================
   Navigation Toggle (Off-Canvas)
===================================== */
(function () {
  const btn = document.querySelector('.hamburger');
  const nav = document.getElementById('mobile-nav');
  const overlay = document.querySelector('.nav-overlay');

  if (!btn || !nav || !overlay) return;

  function openMenu() {
    document.body.classList.add('menu-open');
    overlay.hidden = false;
    btn.setAttribute('aria-expanded', 'true');
    const firstLink = nav.querySelector('a');
    if (firstLink) firstLink.focus({preventScroll:true});
  }
  function closeMenu() {
    document.body.classList.remove('menu-open');
    overlay.hidden = true;
    btn.setAttribute('aria-expanded', 'false');
    btn.focus({preventScroll:true});
  }
  function toggleMenu() {
    if (document.body.classList.contains('menu-open')) closeMenu();
    else openMenu();
  }

  btn.addEventListener('click', toggleMenu);
  overlay.addEventListener('click', closeMenu);

  // ESC zum Schließen
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape' && document.body.classList.contains('menu-open')) {
      closeMenu();
    }
  });

  // Schließen beim Klick auf einen Link
  nav.addEventListener('click', (e) => {
    const a = e.target.closest('a');
    if (a) closeMenu();
  });
})();

/* =====================================
   Sprachschalter (behält Unterseite bei)
===================================== */
(function(){
  const box = document.querySelector('.lang-switch'); if(!box) return;
  const links = box.querySelectorAll('.lang-link');

  // Pfad normalisieren: /index/ -> /, Query/Hash entfernen, doppelte Slashes glätten
  const norm = (p)=>{
    if(!p.startsWith('/')) p = '/' + p;
    p = p.split('#')[0].split('?')[0];
    // /index oder /index/ -> /
    p = p.replace(/\/index(?:\/)?$/i, '/');
    p = p.replace(/\/{2,}/g,'/');
    return p.endsWith('/') ? p : p + '/';
  };

  const path = norm(location.pathname);
  const m = path.match(/^\/(de|en)(\/.*)?$/);
  const currentLang = m ? m[1] : null;
  const rest = m ? (m[2] || '/') : '/';

  // Ziel-Links setzen
  links.forEach(a=>{
    const lang = a.dataset.lang;
    a.href = `/${lang}${rest === '/' ? '/' : rest}`;
    a.setAttribute('aria-pressed', lang === currentLang ? 'true' : 'false');
  });

  // Präferenz speichern
  box.addEventListener('click', e=>{
    const a = e.target.closest('.lang-link'); if(!a) return;
    try{ localStorage.setItem('cw_lang', a.dataset.lang); }catch(_){}
  });

  // Erste Weiterleitung (wenn keine /de oder /en im Pfad)
  if(!currentLang){
    let pref = null; try{ pref = localStorage.getItem('cw_lang'); }catch(_){}
    const fallback = (navigator.language||'en').toLowerCase().startsWith('de') ? 'de' : 'en';
    const target = pref || fallback;
    location.replace(`/${target}/`);
  }
})();

/* =====================================
   Lightbox (mit Mobile Button-Fix & Body-Lock)
   + Format-Fallbacks für AVIF/WebP/JPG
===================================== */
const lbEl = document.querySelector('.lightbox');
const lbImg = lbEl?.querySelector('.lb-img');
const lbPrev = lbEl?.querySelector('.lb-prev');
const lbNext = lbEl?.querySelector('.lb-next');
const lbClose = lbEl?.querySelector('.lb-close');

let LB_LIST = []; // Array von Items: {avif?,webp?,jpg?}
let LB_INDEX = 0;
let LB_OPEN = false;
let restoreFocusEl = null;

function setLbSrcWithFallback(item){
  if (!lbImg || !item) return;
  // Merke aktuellen Schritt
  if (item.avif) {
    lbImg.dataset.tryfmt = 'avif';
    lbImg.src = item.avif;
  } else if (item.webp) {
    lbImg.dataset.tryfmt = 'webp';
    lbImg.src = item.webp;
  } else if (item.jpg) {
    lbImg.dataset.tryfmt = 'jpg';
    lbImg.src = item.jpg;
  }
}

function updateLightbox() {
  if (!LB_LIST.length) return;
  const t = LB_LIST[LB_INDEX];
  setLbSrcWithFallback(t);
}

// Body-Lock Utils
function lockBodyScroll() {
  const y = window.scrollY || document.documentElement.scrollTop || 0;
  document.body.dataset.lockScrollY = String(y);
  document.documentElement.classList.add('no-smooth'); // Smooth temporär aus
  document.body.classList.add('no-smooth', 'no-scroll');
  document.body.style.top = `-${y}px`;
}

function unlockBodyScroll() {
  const y = parseInt(document.body.dataset.lockScrollY || '0', 10);

  // Styles entfernen
  document.body.classList.remove('no-scroll');
  document.body.style.top = '';
  delete document.body.dataset.lockScrollY;

  // In zwei RAF-Ticks zurückscrollen und Smooth erst danach wieder an
  requestAnimationFrame(() => {
    window.scrollTo(0, y);
    requestAnimationFrame(() => {
      document.documentElement.classList.remove('no-smooth');
      document.body.classList.remove('no-smooth');
    });
  });
}

function openLightbox(list, index, sourceEl) {
  LB_LIST = list;
  LB_INDEX = index;
  restoreFocusEl = sourceEl || document.activeElement;

  updateLightbox();
  lbEl.hidden = false;
  lbEl.setAttribute('aria-hidden', 'false');

  lockBodyScroll(); // robustes Scroll-Locking
  LB_OPEN = true;

  // Fokus auf Close für A11y
  lbClose.focus({preventScroll:true});
}

function closeLightbox() {
  lbEl.hidden = true;
  lbEl.setAttribute('aria-hidden', 'true');
  LB_OPEN = false;

  unlockBodyScroll(); // Scroll wiederherstellen

  // Fokus zurück
  if (restoreFocusEl && typeof restoreFocusEl.focus === 'function') {
    restoreFocusEl.focus({preventScroll:true});
  }
}

function prevLightbox() {
  if (!LB_LIST.length) return;
  LB_INDEX = (LB_INDEX - 1 + LB_LIST.length) % LB_LIST.length;
  updateLightbox();
}
function nextLightbox() {
  if (!LB_LIST.length) return;
  LB_INDEX = (LB_INDEX + 1) % LB_LIST.length;
  updateLightbox();
}

if (lbPrev && lbNext && lbClose && lbImg) {
  // onerror-Kaskade für Lightbox
  lbImg.addEventListener('error', ()=>{
    const step = lbImg.dataset.tryfmt || '';
    const t = LB_LIST[LB_INDEX];
    if (!t) return;
    if (step === 'avif' && t.webp) {
      lbImg.dataset.tryfmt = 'webp';
      lbImg.src = t.webp;
    } else if ((step === 'avif' || step === 'webp') && t.jpg) {
      lbImg.dataset.tryfmt = 'jpg';
      lbImg.src = t.jpg;
    }
  });

  // Tap-Wrapper: Aktion ausführen und auf Touch sofort blur()
  const onTap = (fn) => (e) => {
    fn();
    if (matchMedia('(hover: none)').matches) {
      e.currentTarget.blur();
    }
  };

  lbPrev.addEventListener('click', onTap(prevLightbox));
  lbNext.addEventListener('click', onTap(nextLightbox));
  lbClose.addEventListener('click', onTap(closeLightbox));

  // Klick auf Hintergrund schließt (aber nicht, wenn auf Bild/Buttons geklickt)
  lbEl.addEventListener('click', (e) => {
    if (e.target === lbEl) closeLightbox();
  });

  // Tastatursteuerung
  document.addEventListener('keydown', (e) => {
    if (!LB_OPEN) return;
    if (e.key === 'Escape') { e.preventDefault(); closeLightbox(); }
    else if (e.key === 'ArrowLeft') { e.preventDefault(); prevLightbox(); }
    else if (e.key === 'ArrowRight') { e.preventDefault(); nextLightbox(); }
  });

  // Einfache Swipe-Navigation (Touch/Pointer)
  let startX = null;
  lbEl.addEventListener('pointerdown', (e) => { startX = e.clientX; });
  lbEl.addEventListener('pointerup', (e) => {
    if (startX == null) return;
    const dx = e.clientX - startX;
    startX = null;
    const SWIPE_MIN = 40;
    if (dx > SWIPE_MIN) prevLightbox();
    else if (dx < -SWIPE_MIN) nextLightbox();
  });

  // iOS-Safari: Scrollen hinter der Lightbox zusätzlich unterbinden
  lbEl.addEventListener('touchmove', (e) => { e.preventDefault(); }, { passive: false });
}
</script>
</body>
</html>
